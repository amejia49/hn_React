<!DOCTYPE html>
<html>
  <head>
    <title>Hello React</title>
    <link rel="stylesheet" href="css/base.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.0/JSXTransformer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
    <script src="https://cdn.firebase.com/libs/reactfire/0.5.0/reactfire.min.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <script type="text/jsx;harmony=true">
      var Body = React.createClass({
        getInitialState: function(){
          return{
            items:[],
            objects:[],
            displayView: []
          }
        },
        componentWillMount: function(){
this.firebaseRef = new Firebase('https://hacker-news.firebaseio.com/v0/topstories');
            this.firebaseRef.once("value", function(dataSnapshot) {
              this.setState({
              items: dataSnapshot,
              objects: []
              });
              console.log(dataSnapshot);
              this.populateInfo();
            }.bind(this));
        },
        render: function(){
          console.log(this.state.objects)
            return(
              <div>

                <Header/>
                <Post articles = {this.state.displayView}/>
                <p onClick= {this.display30More}> More </p>
              </div>
            //for each newArticle make a new component
            )
          },
        populateInfo: function(){
          var allObjectRef = this.state.items.val();
          
          allObjectRef.forEach(function(item){
              var reference = new Firebase("https://hacker-news.firebaseio.com/v0/item/"+item);
              reference.once('value', function(item){

                this.state.objects.push(<div class="article"> <h1>{item.val().by} </h1> </div>)
                this.checkStatus();
            }.bind(this))
            }.bind(this));
        },
        checkStatus: function(){
           if(this.state.objects.length === 30){
              this.setState({
                displayView: this.state.objects
              })
              console.log(this.state.objects[0]);
            }
            else{
              console.log('Objects length is', this.state.objects.length, this.state.items.val().length)
            }
        },
        display30More:function(){
          var initalRange = this.props.range;
          this.props.range+=30;
          this.setState({
            displayView: this.state.objects.slice(initalRange, this.props.range)
          });
        //   var 30More = this.state.objects.map(function(object){

        //   })
        //   console.log('Show 30 more');
        //   console.log($('.article').last());
        }
      });
      var Header= React.createClass({
        render: 
          function(){
            return(
              <ul>
                <li> <span id= "logo"> Logo </span> </li>
                <li> <span id= "title"> React-Hacker News </span> </li>
                <li> news </li>
                <li> comments </li>
                <li> show </li>
                <li> ask </li>
                <li> jobs </li>
                <li> submit </li>
              </ul>
            )
          }
      })

      var Post= React.createClass({
        render:
          function(){
            return(
              <div> {this.props.articles} </div>
            )
          }
      })

      React.render(<Body range={30}/>, document.getElementById('content'));
    </script>
  </body>
</html>
